<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Music Fullscreen</title>
    <style>
        /* 徹底移除所有外邊距，確保內容貼齊邊緣 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden; /* 禁止網頁本身捲動 */
            background-color: #000; /* 背景設為黑色，避免載入時閃白 */
        }

        /* 創作者模式介面 */
        #creator-ui {
            display: flex;
            height: 100%;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: #fff;
            color: #000;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            text-align: center;
            padding: 20px;
        }

        input {
            width: 80%;
            max-width: 400px;
            border: none;
            border-bottom: 2px solid #000;
            padding: 10px;
            font-size: 1.2rem;
            outline: none;
            margin-bottom: 20px;
            text-align: center;
        }

        button {
            background: #000;
            color: #fff;
            padding: 10px 30px;
            border: none;
            cursor: pointer;
            letter-spacing: 2px;
        }

        /* 分享模式：播放器容器強制全螢幕 */
        #player-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: none;
            z-index: 1;
        }

        /* 重要：強制 iframe 撐開，忽略 Apple 預設的寬度限制 */
        iframe {
            width: 100% !important;
            height: 100% !important;
            max-width: none !important; /* 移除 Apple 預設的 660px 限制 */
            border: none;
            display: block;
        }

        /* 隱藏的分享按鈕：滑鼠移到右上角才會隱約現身 */
        #floating-share {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
            background: rgba(255,255,255,0.2);
            color: #fff;
            padding: 5px 10px;
            font-size: 10px;
            border: 1px solid rgba(255,255,255,0.3);
            cursor: pointer;
            display: none;
            text-transform: uppercase;
            backdrop-filter: blur(5px);
        }
        #floating-share:hover { background: #fff; color: #000; }
    </style>
</head>
<body>

    <!-- 模式 1: 產生連結介面 -->
    <div id="creator-ui">
        <p style="font-size: 10px; letter-spacing: 5px; margin-bottom: 40px;">MUSIC SHARE</p>
        <input type="text" id="url-input" placeholder="貼上 /tw/album/... 連結">
        <button onclick="create()">COPY & PREVIEW</button>
    </div>

    <!-- 模式 2: 全屏播放器 -->
    <div id="player-container">
        <div id="player-mount" style="width: 100%; height: 100%;"></div>
    </div>

    <button id="floating-share" onclick="copyCurrent()">Share Link</button>

    <script>
        const params = new URLSearchParams(window.location.search);
        const musicId = params.get('m');

        if (musicId) {
            startPlayer(musicId);
        }

        function startPlayer(pathData) {
            document.getElementById('creator-ui').style.display = 'none';
            document.getElementById('player-container').style.display = 'block';
            document.getElementById('floating-share').style.display = 'block';

            let path = pathData;
            if (pathData.includes('music.apple.com')) {
                const url = new URL(pathData);
                path = url.pathname + url.search;
            } else if (!pathData.startsWith('/')) {
                path = '/' + pathData;
            }

            // 生成嵌入連結
            const embedUrl = `https://embed.music.apple.com${path}`;
            
            document.getElementById('player-mount').innerHTML = `
                <iframe 
                    allow="autoplay *; encrypted-media *; fullscreen *; clipboard-write" 
                    sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-storage-access-by-user-activation allow-top-navigation-by-user-activation" 
                    src="${embedUrl}">
                </iframe>
            `;
        }

        function create() {
            const val = document.getElementById('url-input').value;
            if (!val) return;
            
            let path = val;
            if (val.includes('music.apple.com')) {
                const url = new URL(val);
                path = url.pathname + url.search;
            }

            const finalLink = window.location.origin + window.location.pathname + '?m=' + encodeURIComponent(path);
            
            navigator.clipboard.writeText(finalLink).then(() => {
                window.location.href = finalLink; // 直接跳轉預覽
            });
        }

        function copyCurrent() {
            navigator.clipboard.writeText(window.location.href).then(() => alert('Copied!'));
        }
    </script>
</body>
</html>
