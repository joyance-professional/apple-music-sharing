<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Music Experience</title>
    <style>
        /* 基礎樣式重置 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* 確保背景填滿，禁止捲動 */
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #ffffff; /* 如果你喜歡深色，可以改為 #000 */
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }

        /* 創作者模式介面 */
        #creator-ui {
            display: flex;
            height: 100%;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            z-index: 10;
            position: relative;
            background: #fff;
        }

        h1 { font-size: 14px; letter-spacing: 4px; margin-bottom: 40px; color: #888; }
        input {
            width: 100%; max-width: 350px; border: none; border-bottom: 1px solid #000;
            padding: 10px; font-size: 16px; outline: none; text-align: center; margin-bottom: 30px;
        }
        button.gen-btn {
            background: #000; color: #fff; padding: 12px 30px; border: none; cursor: pointer;
            font-size: 12px; letter-spacing: 2px;
        }

        /* --- 分享模式：關鍵的全屏置中佈局 --- */
        #player-wrapper {
            display: none; /* 初始隱藏 */
            width: 100vw;
            height: 100vh;
            display: flex;
            align-items: center;    /* 垂直居中 */
            justify-content: center; /* 水平居中 */
            background-color: #ffffff; 
        }

        .player-container {
            width: 100%;
            max-width: 800px; /* 為了美感，限制最大寬度，避免在寬螢幕上拉得太扁 */
            padding: 20px;
            animation: fadeIn 1.2s ease-out;
        }

        iframe {
            width: 100% !important;
            border: none;
            box-shadow: 0 30px 60px rgba(0,0,0,0.1); /* 加入一點柔和陰影增加立體感 */
            border-radius: 20px; /* 配合 Apple Music 的圓角風格 */
        }

        /* 浮動控制鈕 */
        #share-again {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
            color: #aaa;
            text-decoration: none;
            letter-spacing: 2px;
            text-transform: uppercase;
            cursor: pointer;
            z-index: 100;
            display: none;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.98); }
            to { opacity: 1; transform: scale(1); }
        }
    </style>
</head>
<body>

    <!-- 創作者模式 -->
    <div id="creator-ui">
        <h1>CURATOR</h1>
        <input type="text" id="url-input" placeholder="PASTE APPLE MUSIC LINK">
        <button class="gen-btn" onclick="generate()">GENERATE & PREVIEW</button>
    </div>

    <!-- 分享模式 -->
    <div id="player-wrapper">
        <div class="player-container" id="mount-point"></div>
    </div>

    <div id="share-again" onclick="copyLink()">Copy Share Link</div>

    <script>
        const params = new URLSearchParams(window.location.search);
        const m = params.get('m');

        if (m) {
            initPlayer(m);
        }

        function initPlayer(pathData) {
            // 切換 UI
            document.getElementById('creator-ui').style.display = 'none';
            document.getElementById('player-wrapper').style.display = 'flex';
            document.getElementById('share-again').style.display = 'block';

            let path = "";
            if (pathData.includes('music.apple.com')) {
                const url = new URL(pathData);
                path = url.pathname + url.search;
            } else {
                path = pathData.startsWith('/') ? pathData : '/' + pathData;
            }

            // 核心邏輯：判斷高度
            // 如果是 playlist 或 album，給予較大的高度；如果是單曲(i=)，給予較小高度。
            const isCollection = path.includes('playlist') || (path.includes('album') && !path.includes('?i='));
            const frameHeight = isCollection ? "450px" : "180px";

            const embedUrl = `https://embed.music.apple.com${path}`;
            
            document.getElementById('mount-point').innerHTML = `
                <iframe 
                    allow="autoplay *; encrypted-media *; fullscreen *; clipboard-write" 
                    sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-storage-access-by-user-activation allow-top-navigation-by-user-activation" 
                    style="height: ${frameHeight};"
                    src="${embedUrl}">
                </iframe>
            `;
        }

        function generate() {
            const val = document.getElementById('url-input').value.trim();
            if (!val) return;
            
            let path = val;
            if (val.includes('music.apple.com')) {
                const url = new URL(val);
                path = url.pathname + url.search;
            }

            const finalUrl = window.location.origin + window.location.pathname + '?m=' + encodeURIComponent(path);
            
            navigator.clipboard.writeText(finalUrl).then(() => {
                window.location.href = finalUrl;
            });
        }

        function copyLink() {
            navigator.clipboard.writeText(window.location.href).then(() => {
                alert('Link Copied');
            });
        }
    </script>
</body>
</html>
